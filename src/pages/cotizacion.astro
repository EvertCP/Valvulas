---
import MainLayout from '../layouts/MainLayout.astro';
---

<MainLayout title="Solicitud de Cotización">
  <section class="quote-section">
    <div class="container">
      <div class="quote-header">
        <h1>Solicitar Cotización</h1>
        <p class="quote-description">Complete el formulario para recibir una cotización personalizada de nuestros productos.</p>
      </div>

      <form id="quoteForm" class="quote-form">
        <!-- Paso 1: Información Personal -->
        <div class="form-step" data-step="1">
          <h2>Información Personal</h2>
          <div class="form-grid">
            <div class="form-group">
              <label for="nombre">Nombre*</label>
              <input type="text" id="nombre" name="nombre" required placeholder="Tu nombre completo">
            </div>
            <div class="form-group">
              <label for="empresa">Empresa</label>
              <input type="text" id="empresa" name="empresa" placeholder="Nombre de tu empresa">
            </div>
            <div class="form-group">
              <label for="email">Email*</label>
              <input type="email" id="email" name="email" required placeholder="tu@email.com">
            </div>
            <div class="form-group">
              <label for="telefono">Teléfono*</label>
              <input type="tel" id="telefono" name="telefono" required placeholder="(55) XXXX-XXXX">
            </div>
          </div>
        </div>

        <!-- Paso 2: Selección de Productos -->
        <div class="form-step" data-step="2" style="display: none;">
          <h2>Selección de Productos</h2>
          <div class="product-selector">
          <!-- Selector de Material -->
            <div class="product-category">
              <h3>Material</h3>
              <div class="material-options">
                <label class="material-option">
                  <input type="radio" name="material" value="acero-inoxidable">
                  <span class="option-content">
                    <span class="option-text">Acero Inoxidable</span>
                  </span>
                </label>
                <label class="material-option">
                  <input type="radio" name="material" value="bronce">
                  <span class="option-content">
                    <span class="option-text">Bronce</span>
                  </span>
                </label>
              </div>
            </div>

            <div class="product-category">
              <h3>Modelo de Válvula</h3>
              <div class="product-options" id="valvulaOptions">
                <p class="select-material-message">Por favor, seleccione primero el material</p>
                <!-- Las opciones de válvulas se cargarán dinámicamente -->
              </div>
            </div>
          </div>
        </div>

        <!-- Paso 3: Especificaciones -->
        <div class="form-step" data-step="3" style="display: none;">
          <h2>Especificaciones Técnicas</h2>
          <div class="form-grid">
            <div class="form-group">
              <label for="tamaño">Tamaño (pulgadas)</label>
              <select id="tamaño" name="tamaño" required>
                <option value="">Seleccionar tamaño orificio</option>
                <option value="0.5">A 0.062</option>
                <option value="0.75">B 0.184</option>
                <option value="1">C 0.442</option>
                <option value="1.5">D 0.11</option>
                <option value="2">E 0.196</option>
                <option value="3">F 0.307</option>
                <option value="4">G 0.503</option>
                <option value="5">H 0.785</option>
                <option value="6">J 1.287</option>
                <option value="8">K 1.853</option>
                <option value="10">L 2.853</option>
                <option value="12">M 3.6</option>
                <option value="16">N 4.34</option>
                <option value="20">P 6.38</option>
                <option value="25">O 11.05</option>
                <option value="30">R 16</option>
                <option value="35">T 26</option>
              </select>
            </div>
            <div class="form-group">
              <label for="presion">Tipo de Construcción (PSI)</label>
              <select id="presion" name="presion" required>
                <option value="">Seleccionar presión</option>
                <option value="150">X Convencional</option>
                <option value="300">Y Balanceada</option>
                <option value="600">Z Convencional con Sello Blando</option>
                <option value="900">W Balanceada con Sello Blando</option>
              </select>
            </div>
            <div class="form-group">
              <label for="materiales">Rango de Temperatura y Materiales</label>
              <select id="materiales" name="materiales" required>
                <option value="">Seleccionar material</option>
                <option value="acero-inox">-20 A 450°F</option>
                <option value="bronce">451 A 800°F</option>
                <option value="bronce">801 A 1000°F</option>
                <option value="bronce">-21 A -75°F</option>
                <option value="bronce">-70 A -150°F</option>
                <option value="bronce">-151 A -450°F</option>
                <option value="bronce">Vapor Saturado</option>
              </select>
            </div>
            <div class="form-group">
              <label for="brida">Rango de Brida</label>
              <select id="brida" name="brida" required>
                <option value="">Seleccionar valor</option>
                <option value="acero-inox">150#</option>
                <option value="bronce">300# Pesado</option>
                <option value="bronce">300# Ligero</option>
                <option value="bronce">600#</option>
                <option value="bronce">900#</option>
                <option value="bronce">1500#</option>
                <option value="bronce">2500#</option>
                <option value="bronce">Sin brida</option>
              </select>
            </div>
            <div class="form-group">
              <label for="entrada">Cara de entrada de la valvula</label>
              <select id="entrada" name="entrada" required>
                <option value="">Seleccionar valor</option>
                <option value="acero-inox">M Rosacada Macho</option>
                <option value="bronce">H Roscada Hembra</option>
                <option value="bronce">1 Realizada (RF)</option>
                <option value="bronce">2 Metalica A.N.S.I STD (RTJ)</option>
                <option value="bronce">3 Escpecial</option>
              </select>
            </div>
            <div class="form-group">
              <label for="accesorios_valvula">Accesorios de Válvula</label>
              <select id="accesorios_valvula" name="accesorios_valvula" required>
                <option value="">Seleccionar valor</option>
                <option value="capucha">Capucha Roscada</option>
                <option value="palanca-simple">Palanca de Acción Sencilla</option>
                <option value="palanca-doble">Palanca de Acción Doble</option>
                <option value="palanca-yugo">Palanca y Yugo</option>
              </select>
            </div>
            <div class="form-group">
              <label for="mordaza">Mordaza de Prueba</label>
              <select id="mordaza" name="mordaza" required>
                <option value="">Seleccionar valor</option>
                <option value="sin-mordaza">Sin mordaza</option>
                <option value="con-mordaza">Con mordaza</option>
              </select>
            </div>
            <div class="form-group">
              <label for="roscadas">Solo para válvulas roscadas</label>
              <select id="roscadas" name="roscadas">
                <option value="">Seleccionar valor</option>
                <option value="1/2">1/2" N.P.T</option>
                <option value="3/4">3/4" N.P.T</option>
                <option value="1">1" N.P.T</option>
                <option value="1 1/4">1 1/4" N.P.T</option>
                <option value="1 1/2">1 1/2" N.P.T</option>
                <option value="2">2" N.P.T</option>
                <option value="2 1/2">2 1/2" N.P.T</option>
              </select>
            </div>
            <div class="form-group">
              <label for="cantidad">Cantidad</label>
              <input type="number" id="cantidad" name="cantidad" min="1" required placeholder="Cantidad requerida">
            </div>
          </div>
        </div>

        <!-- Paso 4: Comentarios Adicionales -->
        <div class="form-step" data-step="4" style="display: none;">
          <h2>Comentarios Adicionales</h2>
          <div class="form-group">
            <label for="comentarios">Comentarios o Especificaciones Adicionales</label>
            <textarea id="comentarios" name="comentarios" rows="4" placeholder="Proporcione cualquier detalle adicional que considere importante..."></textarea>
          </div>
        </div>

        <!-- Paso 5: Confirmación -->
        <div class="form-step" data-step="5" style="display: none;">
          <h2>Confirmación de Pedido</h2>
          <div class="confirmation-summary">
            <h3>Información Personal</h3>
            <div id="personal-info-summary" class="summary-section"></div>
            
            <h3>Producto Seleccionado</h3>
            <div id="product-summary" class="summary-section"></div>
            
            <h3>Especificaciones Técnicas</h3>
            <div id="specs-summary" class="summary-section"></div>
            
            <h3>Comentarios Adicionales</h3>
            <div id="comments-summary" class="summary-section"></div>
          </div>
        </div>

        <!-- Navegación entre pasos -->
        <div class="form-navigation">
          <div class="step-indicators">
            <span class="step-indicator active" data-step="1"></span>
            <span class="step-indicator" data-step="2"></span>
            <span class="step-indicator" data-step="3"></span>
            <span class="step-indicator" data-step="4"></span>
            <span class="step-indicator" data-step="5"></span>
          </div>
          <div class="navigation-buttons">
            <button type="button" class="nav-button" id="prevStep" style="display: none;">Anterior</button>
            <button type="button" class="nav-button primary" id="nextStep">Siguiente</button>
            <button type="submit" class="submit-button" id="submitQuote" style="display: none;">Solicitar Cotización</button>
          </div>
        </div>
      </form>
    </div>
  </section>

  <style>
    .quote-section {
      padding: var(--spacing-3xl) var(--spacing-xl);
      background: linear-gradient(135deg, var(--color-background) 0%, var(--color-background-alt) 100%);
      min-height: 100vh;
      padding-top: calc(var(--spacing-4xl) + 80px); /* Aumentado el padding superior */
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 var(--spacing-xl);
    }

    .quote-header {
      text-align: center;
      margin-bottom: var(--spacing-2xl);
      animation: fadeIn 0.8s ease-out;
      margin-top: var(--spacing-xl); /* Añadido margen superior extra */
    }

    .quote-header h1 {
      font-size: var(--font-size-3xl);
      color: var(--color-primary);
      margin-bottom: var(--spacing-md);
      font-weight: 700;
      line-height: 1.2;
    }

    .quote-description {
      font-size: var(--font-size-lg);
      color: var(--color-text-light);
      max-width: 600px;
      margin: 0 auto;
    }

    .quote-form {
      background: var(--color-background);
      padding: var(--spacing-3xl);
      border-radius: var(--radius-xl);
      box-shadow: 0 10px 30px rgba(0,0,0,0.1);
      animation: slideUp 0.8s ease-out;
      max-width: 1000px;
      margin: 0 auto;
    }

    .form-step {
      margin-bottom: var(--spacing-3xl);
      transition: all 0.3s ease;
      padding: var(--spacing-xl) 0;
    }

    .form-step h2 {
      color: var(--color-primary);
      font-size: var(--font-size-2xl);
      margin-bottom: var(--spacing-xl);
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: var(--spacing-sm);
    }

    .form-step h2::before {
      content: '';
      display: block;
      width: 4px;
      height: 24px;
      background: var(--color-primary);
      border-radius: var(--radius-sm);
    }

    .form-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: var(--spacing-2xl);
      margin-top: var(--spacing-xl);
    }

    .form-group {
      margin-bottom: var(--spacing-xl);
    }

    .form-group label {
      display: block;
      margin-bottom: var(--spacing-sm);
      color: var(--color-text);
      font-weight: 500;
      font-size: var(--font-size-base);
    }

    .form-group input,
    .form-group select,
    .form-group textarea {
      width: 100%;
      padding: var(--spacing-md);
      border: 2px solid var(--color-border);
      border-radius: var(--radius-lg);
      background: var(--color-background);
      color: var(--color-text);
      font-size: var(--font-size-base);
      transition: all 0.3s ease;
    }

    .form-group input:focus,
    .form-group select:focus,
    .form-group textarea:focus {
      border-color: var(--color-primary);
      box-shadow: 0 0 0 3px rgba(var(--color-primary-rgb), 0.2);
      outline: none;
    }

    .form-group input::placeholder,
    .form-group textarea::placeholder {
      color: var(--color-text-light);
    }

    .product-selector {
      margin-top: var(--spacing-2xl);
    }

    .product-category {
      margin-bottom: var(--spacing-2xl);
    }

    .material-options {
      display: flex;
      gap: var(--spacing-lg);
      margin-bottom: var(--spacing-xl);
    }

    .material-option {
      flex: 1;
      cursor: pointer;
      padding: var(--spacing-md);
      border: 2px solid var(--color-border);
      border-radius: var(--border-radius);
      transition: all 0.3s ease;
    }

    .material-option:hover {
      border-color: var(--color-primary);
    }

    .material-option input[type="radio"]:checked + .option-content {
      color: var(--color-primary);
    }

    .select-material-message {
      text-align: center;
      color: var(--color-text-muted);
      padding: var(--spacing-lg);
    }

    .product-options {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
      gap: var(--spacing-xl);
      padding: var(--spacing-lg);
    }

    .product-option {
      cursor: pointer;
      transition: transform 0.3s ease;
    }

    .product-option:hover {
      transform: translateY(-5px);
    }

    .option-content {
      background: var(--color-background);
      padding: var(--spacing-xl);
      border: 2px solid var(--color-border);
      border-radius: var(--radius-xl);
      transition: all 0.3s ease;
      height: 100%;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .product-option input[type="radio"]:checked + .option-content {
      border-color: var(--color-primary);
      box-shadow: 0 8px 20px rgba(var(--color-primary-rgb), 0.15);
      transform: translateY(-5px);
    }

    .option-content img {
      width: 100%;
      height: 180px;
      object-fit: cover;
      border-radius: var(--radius-lg);
      margin-bottom: var(--spacing-md);
      transition: transform 0.3s ease;
    }

    .option-content:hover img {
      transform: scale(1.05);
    }

    .option-text {
      font-weight: 600;
      color: var(--color-text);
      text-align: center;
      margin-top: var(--spacing-sm);
    }

    .form-navigation {
      margin-top: var(--spacing-3xl);
      padding-top: var(--spacing-2xl);
      border-top: 2px solid var(--color-border);
    }

    .step-indicators {
      display: flex;
      justify-content: center;
      gap: var(--spacing-md);
      margin-bottom: var(--spacing-2xl);
    }

    .step-indicator {
      width: 40px;
      height: 4px;
      background: var(--color-border);
      border-radius: var(--radius-full);
      transition: all 0.3s ease;
    }

    .step-indicator.active {
      background: var(--color-primary);
      width: 60px;
    }

    .navigation-buttons {
      display: flex;
      justify-content: center;
      gap: var(--spacing-xl);
      margin-top: var(--spacing-2xl);
    }

    .nav-button,
    .submit-button {
      padding: var(--spacing-lg) var(--spacing-2xl);
      font-size: var(--font-size-lg);
      margin: 10px auto;
      min-width: 180px;
      min-height: 50px;
      border-radius: var(--radius-md);
      font-weight: 600;
      cursor: pointer;
      transition: all var(--transition-normal);
      display: inline-flex;
      align-items: center;
      justify-content: center;
      text-decoration: none;
      border: none;
      position: relative;
      overflow: hidden;
    }

    .nav-button.primary {
      background: var(--color-primary);
      color: white;
      min-width: 200px;
      min-height: 40px;
      box-shadow: var(--shadow-md);
    }

    .nav-button::after,
    .submit-button::after {
      content: '';
      position: absolute;
      width: 100%;
      height: 100%;
      top: 0;
      left: 0;
      background: linear-gradient(rgba(255,255,255,0.2), transparent);
      pointer-events: none;
    }

    .nav-button.primary {
      background: var(--color-primary);
      color: white;
      min-width: 200px;
      box-shadow: var(--shadow-md);
    }

    .nav-button:not(.primary) {
      background: transparent;
      color: var(--color-primary);
      border: 2px solid var(--color-primary);
    }

    .nav-button:hover,
    .submit-button:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow-lg);
    }

    .nav-button:active,
    .submit-button:active {
      transform: translateY(1px);
    }

    .nav-button.primary:hover {
      background: var(--color-primary-dark);
    }

    .nav-button:not(.primary):hover {
      background: rgba(var(--color-primary-rgb), 0.1);
    }

    .submit-button {
      background: linear-gradient(135deg, var(--color-primary) 0%, var(--color-primary-dark) 100%);
      color: white;
      min-width: 240px;
      box-shadow: var(--shadow-md);
      position: relative;
      overflow: hidden;
    }

    .submit-button:hover {
      background: linear-gradient(135deg, var(--color-primary-dark) 0%, var(--color-primary-dark) 100%);
    }

    .submit-button:disabled {
      background: var(--color-text-light);
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }

    .nav-button::before,
    .submit-button::before {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 0;
      height: 0;
      background: rgba(255,255,255,0.2);
      border-radius: 50%;
      transform: translate(-50%, -50%);
      transition: width 0.6s ease-out, height 0.6s ease-out;
    }

    .nav-button:active::before,
    .submit-button:active::before {
      width: 400px;
      height: 400px;
    }

    @media (max-width: 768px) {
      .quote-section {
        padding: var(--spacing-xl) var(--spacing-md);
      }

      .quote-form {
        padding: var(--spacing-xl);
      }

      .form-step {
        padding: var(--spacing-lg) 0;
      }

      .form-grid {
        gap: var(--spacing-xl);
      }

      .navigation-buttons {
        flex-direction: column;
        gap: var(--spacing-md);
        padding: 0 var(--spacing-md);
      }

      .nav-button,
      .submit-button {
        width: 100%;
        min-width: 100%;
        padding: var(--spacing-md) var(--spacing-lg);
      }
    }

    .error {
      border-color: var(--color-error) !important;
    }

    .error-message {
      color: var(--color-error);
      font-size: var(--font-size-sm);
      margin-top: var(--spacing-xs);
    }

    .confirmation-summary {
      background: var(--color-background-alt);
      padding: var(--spacing-2xl);
      border-radius: var(--radius-lg);
      margin-top: var(--spacing-xl);
    }

    .confirmation-summary h3 {
      color: var(--color-primary);
      margin-bottom: var(--spacing-md);
      font-size: var(--font-size-lg);
      border-bottom: 2px solid var(--color-border);
      padding-bottom: var(--spacing-sm);
    }

    .summary-section {
      margin-bottom: var(--spacing-2xl);
      font-size: var(--font-size-base);
    }

    .summary-section p {
      margin: var(--spacing-xs) 0;
      display: flex;
      justify-content: space-between;
    }

    .summary-section strong {
      color: var(--color-text);
    }
  </style>

  <script>
    // Definir las opciones de válvulas por material
    const valvulasOptions = {
      'acero-inoxidable': [
        { value: 'serie1000', text: 'Serie 1000', image: '/productos/valvula-compuerta.jpg'},
        { value: 'serie2000', text: 'Serie 2000', image: '/productos/valvula-bola.jpg'},
        { value: 'serie7500', text: 'Serie 7500', image: '/productos/valvula-mariposa.jpg'}
      ],
      'bronce': [
        { value: 'serie9900', text: 'Serie 9900', image: '/productos/valvula-globo.jpg'},
        { value: 'serie1500', text: 'Serie 1500', image: '/productos/valvula-globo.jpg'},
        { value: 'serie1600', text: 'Serie 1600', image: '/productos/valvula-globo.jpg'},
        { value: 'serie1700', text: 'Serie 1700', image: '/productos/valvula-globo.jpg'},
        { value: 'serie86', text: 'Serie 86', image: '/productos/valvula-globo.jpg'}
      ]
    };

    function updateValvulaOptions() {
      const selectedMaterial = document.querySelector('input[name="material"]:checked')?.value;
      const valvulaOptionsContainer = document.getElementById('valvulaOptions');
      
      if (!selectedMaterial) {
        valvulaOptionsContainer.innerHTML = '<p class="select-material-message">Por favor, seleccione primero el material</p>';
        return;
      }

      const options = valvulasOptions[selectedMaterial];
      let optionsHTML = '';
      
      options.forEach(option => {
        optionsHTML += `
          <label class="product-option">
            <input type="radio" name="modeloValvula" value="${option.value}">
            <span class="option-content">
              <img src="${option.image}" alt="Válvula de ${option.text}">
              <span class="option-text">${option.text}</span>
            </span>
          </label>
        `;
      });

      valvulaOptionsContainer.innerHTML = optionsHTML;
    }

    document.addEventListener('DOMContentLoaded', () => {
      let currentStep = 1;
      const totalSteps = 5;

      // Agregar event listeners para los radio buttons de material
      const materialRadios = document.querySelectorAll('input[name="material"]');
      materialRadios.forEach(radio => {
        radio.addEventListener('change', updateValvulaOptions);
      });

      // Llamar a updateValvulaOptions inicialmente
      updateValvulaOptions();

      function validateCurrentStep() {
        const currentStepElement = document.querySelector(`[data-step="${currentStep}"]`);
        const requiredFields = currentStepElement.querySelectorAll('[required]');
        let isValid = true;

        document.querySelectorAll('.error-message').forEach(msg => msg.remove());
        document.querySelectorAll('.error').forEach(field => field.classList.remove('error'));

        requiredFields.forEach(field => {
          if (!field.value) {
            isValid = false;
            field.classList.add('error');
            
            const errorMessage = document.createElement('div');
            errorMessage.className = 'error-message';
            errorMessage.textContent = 'Este campo es requerido';
            field.parentNode.appendChild(errorMessage);
          } else if (field.type === 'email' && !isValidEmail(field.value)) {
            isValid = false;
            field.classList.add('error');
            
            const errorMessage = document.createElement('div');
            errorMessage.className = 'error-message';
            errorMessage.textContent = 'Por favor ingrese un email válido';
            field.parentNode.appendChild(errorMessage);
          } else if (field.type === 'tel' && !isValidPhone(field.value)) {
            isValid = false;
            field.classList.add('error');
            
            const errorMessage = document.createElement('div');
            errorMessage.className = 'error-message';
            errorMessage.textContent = 'Por favor ingrese un teléfono válido';
            field.parentNode.appendChild(errorMessage);
          } else if (field.type === 'number' && field.value < 1) {
            isValid = false;
            field.classList.add('error');
            
            const errorMessage = document.createElement('div');
            errorMessage.className = 'error-message';
            errorMessage.textContent = 'La cantidad debe ser mayor a 0';
            field.parentNode.appendChild(errorMessage);
          }
        });

        if (currentStep === 2) {
          const selectedProduct = document.querySelector('input[name="modeloValvula"]:checked');
          if (!selectedProduct) {
            isValid = false;
            const productSelector = document.querySelector('.product-selector');
            const errorMessage = document.createElement('div');
            errorMessage.className = 'error-message';
            errorMessage.textContent = 'Por favor seleccione un producto';
            productSelector.appendChild(errorMessage);
          }
        }

        return isValid;
      }

      function isValidEmail(email) {
        return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
      }

      function isValidPhone(phone) {
        return /^[\d\s()-]+$/.test(phone) && phone.replace(/\D/g, '').length >= 10;
      }

      function updateSummary() {
        if (currentStep === 5) {
          // Información Personal
          const personalInfo = document.getElementById('personal-info-summary');
          personalInfo.innerHTML = `
            <p><strong>Nombre:</strong> ${document.getElementById('nombre').value}</p>
            <p><strong>Empresa:</strong> ${document.getElementById('empresa').value || 'No especificada'}</p>
            <p><strong>Email:</strong> ${document.getElementById('email').value}</p>
            <p><strong>Teléfono:</strong> ${document.getElementById('telefono').value}</p>
          `;

          // Producto Seleccionado
          const productSummary = document.getElementById('product-summary');
          const selectedValve = document.querySelector('input[name="modeloValvula"]:checked');
          productSummary.innerHTML = `
            <p><strong>Modelo:</strong> ${selectedValve ? selectedValve.parentElement.querySelector('.option-text').textContent : 'No seleccionado'}</p>
            <p><strong>Cantidad:</strong> ${document.getElementById('cantidad').value}</p>
          `;

          // Especificaciones Técnicas
          const specsSummary = document.getElementById('specs-summary');
          specsSummary.innerHTML = `
            <p><strong>Material:</strong> ${document.getElementById('material').selectedOptions[0].text}</p>
            <p><strong>Tamaño:</strong> ${document.getElementById('tamaño').selectedOptions[0].text}</p>
            <p><strong>Tipo de Construcción:</strong> ${document.getElementById('presion').selectedOptions[0].text}</p>
            <p><strong>Rango de Temperatura:</strong> ${document.getElementById('materiales').selectedOptions[0].text}</p>
            <p><strong>Rango de Brida:</strong> ${document.getElementById('brida').selectedOptions[0].text}</p>
            <p><strong>Cara de entrada:</strong> ${document.getElementById('entrada').selectedOptions[0].text}</p>
            <p><strong>Accesorios:</strong> ${document.getElementById('accesorios_valvula').selectedOptions[0].text}</p>
            <p><strong>Mordaza de Prueba:</strong> ${document.getElementById('mordaza').selectedOptions[0].text}</p>
          `;

          if (document.getElementById('roscadas').value) {
            specsSummary.innerHTML += `
              <p><strong>Especificación Roscada:</strong> ${document.getElementById('roscadas').selectedOptions[0].text}</p>
            `;
          }

          // Comentarios
          const commentsSummary = document.getElementById('comments-summary');
          const comentarios = document.getElementById('comentarios').value;
          commentsSummary.innerHTML = comentarios ? `<p>${comentarios}</p>` : '<p>Sin comentarios adicionales</p>';
        }
      }

      function updateStepVisibility() {
        document.querySelectorAll('.form-step').forEach(step => {
          step.style.display = 'none';
        });
        
        const currentStepElement = document.querySelector(`[data-step="${currentStep}"]`);
        currentStepElement.style.display = 'block';
        currentStepElement.style.opacity = '0';
        setTimeout(() => {
          currentStepElement.style.opacity = '1';
        }, 50);
        
        document.querySelectorAll('.step-indicator').forEach((indicator, index) => {
          indicator.classList.toggle('active', index + 1 <= currentStep);
        });
        
        const prevButton = document.getElementById('prevStep');
        const nextButton = document.getElementById('nextStep');
        const submitButton = document.getElementById('submitQuote');
        
        if (prevButton && nextButton && submitButton) {
          prevButton.style.display = currentStep === 1 ? 'none' : 'block';
          nextButton.style.display = currentStep === totalSteps ? 'none' : 'block';
          submitButton.style.display = currentStep === totalSteps ? 'block' : 'none';
        }

        updateSummary();
      }

      document.getElementById('nextStep')?.addEventListener('click', () => {
        if (validateCurrentStep()) {
          if (currentStep < totalSteps) {
            currentStep++;
            updateStepVisibility();
          }
        }
      });

      document.getElementById('prevStep')?.addEventListener('click', () => {
        if (currentStep > 1) {
          currentStep--;
          updateStepVisibility();
        }
      });

      document.getElementById('quoteForm')?.addEventListener('submit', async (e) => {
        e.preventDefault();
        
        if (validateCurrentStep()) {
          const formData = new FormData(e.target);
          const data = Object.fromEntries(formData.entries());
          
          try {
            const submitButton = document.getElementById('submitQuote');
            if (submitButton) {
              submitButton.disabled = true;
              submitButton.textContent = 'Enviando...';
            }

            const response = await fetch('/api/quote', {
              method: 'POST',
              headers: {
                'Content-Type': 'application/json',
              },
              body: JSON.stringify(data),
            });

            if (response.ok) {
              alert('¡Cotización enviada con éxito! Nos pondremos en contacto contigo pronto.');
              window.location.href = '/';
            } else {
              throw new Error('Error al enviar la cotización');
            }
          } catch (error) {
            console.error('Error:', error);
            alert('Lo sentimos, hubo un error al enviar la cotización. Por favor, intenta nuevamente.');
          } finally {
            const submitButton = document.getElementById('submitQuote');
            if (submitButton) {
              submitButton.disabled = false;
              submitButton.textContent = 'Solicitar Cotización';
            }
          }
        }
      });

      updateStepVisibility();

      document.querySelectorAll('input, select, textarea').forEach(field => {
        field.addEventListener('input', () => {
          field.classList.remove('error');
          const errorMessage = field.parentNode.querySelector('.error-message');
          if (errorMessage) {
            errorMessage.remove();
          }
        });
      });
    });
  </script>
</MainLayout>
